---
title: "EV Power - Lab 4 Project Report"
format: typst
---

## **Part 0: libraries**

```{r}
#| message: false
#| warning: false
library(sf)
library(rnaturalearth)
library(maps)
library(dplyr)
library(tidyr)
library(stringr)
library(ggplot2)
```

## **Part 1:** **Defining Research Question**

Chosen Question: How has the share of renewable energy changed from 2021–2023 across states? What is the share of electricity that comes from clean sources by state?

## **Part 2: Data Preparation and Cleaning**

```{r}
renew2021 <- read.csv("data/renew-use-2021.csv")
renew2022 <- read.csv("data/renew-use-2022.csv")
renew2023 <- read.csv("data/renew-use-2023.csv")
total2021 <- read.csv("data/total-use-2021.csv")
total2022 <- read.csv("data/total-use-2022.csv")
total2023 <- read.csv("data/total-use-2023.csv")
```
```{r}
renew2021 <- renew2021|>
    mutate(Renewable_Use_2021 = as.numeric(str_extract(Renewable_Use_2021, "\\d+\\.?\\d*")))
renew2022 <- renew2022|>
    mutate(Renewable_Use_2022 = as.numeric(str_extract(Renewable_Use_2022, "\\d+\\.?\\d*")))
renew2023 <- renew2023|>
    mutate(Renewable_Use_2023 = as.numeric(str_extract(Renewable_Use_2023, "\\d+\\.?\\d*")))
```

```{r}
total2021 <- total2021|>
    mutate(Energy_Source = str_replace_all(Energy_Source, "[^A-Za-z]", ""))
total2022$Energy_Source <- total2021$Energy_Source
total2023$Energy_Source <- total2021$Energy_Source
```

```{r}
standardize_state <- function(df) {
  df <- df |>
    mutate(State = str_to_upper(State))
  return(df)
}
renew2021 <- standardize_state(renew2021)
renew2022 <- standardize_state(renew2022)
renew2023 <- standardize_state(renew2023)
```

## **Part 3: Joining / Pivoting Datasets for Analysis**

```{r}
renew_2 <- full_join(x=renew2021, y=renew2022, by=c("State", "Energy_Source"))
renew_all <- full_join(x=renew_2, y=renew2023, by=c("State", "Energy_Source"))
head(renew_all)
```

## **Part 4: Mapping Visualization**

```{r}
us_states <- ne_states(country = "United States of America", returnclass = "sf")
renew_state_summary <- renew_all |>
  group_by(State) |>
  summarize(Renewable_Use_2021 = sum(Renewable_Use_2021, na.rm = TRUE), Renewable_Use_2023 = sum(Renewable_Use_2023, na.rm = TRUE))
us_joined <- us_states |>
  left_join(renew_state_summary, by = join_by(postal == State))|>
  mutate(Change = Renewable_Use_2023 - Renewable_Use_2021)
renew_state_summary
ggplot(us_joined) +
  geom_sf(aes(fill = Change), color = "white") +
  scale_fill_distiller(
    palette = "RdYlGn",
    direction = 1,
    name = "Change (2021–2023)")+
  labs(title = "Change in Renewable Energy Use (2021–2023)") +
  coord_sf(xlim = c(-125, -66), ylim = c(24, 50), expand = FALSE) +
  theme_minimal()
```

The map shows that renewable energy use has gone up in most states between 2021 and 2023, but the change is not even everywhere as when some states in the West and Northeast show bigger growth in renewables, some Southern and Midwestern states have smaller changes or almost none. This might be because of differences in how much each state invests in renewable projects or how heavily they rely on other energy sources like coal or gas. When looking at the color scale, we can easily see states like California and Texas are leading in renewable energy growth and fossil-fuel-heavy regions (e.g., parts of the South) lag behind.